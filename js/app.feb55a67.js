(function(){"use strict";var e={901:function(e,o,n){var a=n(5130),t=n(657),l=n(6768);const s={id:"app",class:"d-flex flex-column vh-100"},r={class:"d-flex flex-column overflow-hidden"};function i(e,o,n,a,t,i){const c=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",s,[(0,l.Lk)("div",r,[(0,l.bF)(c)])])}var c=n(144),u={name:"App",components:{},setup(){const e=(0,c.KR)(!1),o=(0,c.KR)("載入中..."),n=(0,c.KR)(0),a=(0,c.KR)(!1),t=(0,c.KR)("");return{isLoading:e,loadingText:o,loadingProgress:n,showLoadingProgress:a,loadingSubText:t}}},p=n(1241);const d=(0,p.A)(u,[["render",i]]);var v=d,g=n(1387);const m={id:"app",class:"d-flex flex-column vh-100"},y={class:"flex-grow-1 overflow-hidden position-relative"};function f(e,o,n,a,t,s){const r=(0,l.g2)("MapTab");return(0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("div",y,[(0,l.bF)(r,{onMapReady:a.setMapInstance},null,8,["onMapReady"])])])}var h=n(4232);const w={id:"map-container",class:"h-100 w-100 position-relative bg-transparent z-0"},b={class:"position-absolute",style:{top:"50%",left:"0",transform:"translateY(-50%)","z-index":"1000",padding:"1rem"}},L={class:"bg-dark bg-opacity-75 rounded-3 p-3"},M={class:""},k={class:"d-flex flex-column gap-1"},C=["id"];function x(e,o,n,a,t,s){return(0,l.uX)(),(0,l.CE)("div",w,[(0,l.Lk)("div",b,[(0,l.Lk)("div",L,[(0,l.Lk)("div",M,[(0,l.Lk)("div",k,[(0,l.Lk)("button",{type:"button",class:(0,h.C4)(["btn border-0 my-country-btn my-font-sm-white px-4 py-3",["point"===a.displayMode?"active":""]]),onClick:o[0]||(o[0]=e=>a.toggleDisplayMode("point"))}," POINT ",2),(0,l.Lk)("button",{type:"button",class:(0,h.C4)(["btn border-0 my-country-btn my-font-sm-white px-4 py-3",["heatmap"===a.displayMode?"active":""]]),onClick:o[1]||(o[1]=e=>a.toggleDisplayMode("heatmap"))}," HEATMAP ",2)])])])]),(0,l.Lk)("div",{id:a.mapContainerId,ref:"mapContainer",class:"h-100 w-100"},null,8,C)])}n(8111),n(7588),n(1701);var T=n(6886),_=n.n(T);n(954),n(2489),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);const R=(0,t.nY)("data",(()=>{const e=(0,c.KR)([]),o=(0,c.KR)(!1),n=(0,c.KR)(null),a=(0,c.KR)(null),t=(0,c.KR)(null),s=async()=>{o.value=!0,n.value=null;try{console.log("📍 開始載入 JSON 文件...");const o=await fetch("/30DayMapChallenge-15_Fire/data/已儲存的地點.json");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();e.value=n.features||[],console.log(`📍 成功載入 ${e.value.length} 個儲存的地點`)}catch(a){n.value=a.message,console.error("❌ 載入儲存的地點數據失敗:",a)}finally{o.value=!1}},r=e=>{a.value=e},i=e=>{t.value=e},u=o=>o?e.value.filter((e=>{const n=e.properties?.location?.name||"",a=e.properties?.location?.address||"";return n.toLowerCase().includes(o.toLowerCase())||a.toLowerCase().includes(o.toLowerCase())})):e.value,p=(0,l.EW)((()=>{const o=e.value.length,n=[...new Set(e.value.map((e=>e.properties?.location?.country_code||"Unknown")))];return{total:o,countries:n.length,countryList:n}}));return{savedLocations:e,loading:o,error:n,mapInstance:a,selectedFeature:t,loadSavedLocations:s,setMapInstance:r,setSelectedFeature:i,searchLocations:u,getStatistics:p}}),{persist:!0}),z=(0,t.nY)("define",{state:()=>({selectedBasemap:"google_satellite",mapView:{center:[0,0],zoom:2},basemaps:[{label:"Google Satellite",value:"google_satellite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"}]}),actions:{setSelectedBasemap(e){this.selectedBasemap=e},setMapView(e,o){this.mapView.center=e,this.mapView.zoom=o}}});var S={name:"MapTab",emits:["map-ready"],setup(e,{emit:o}){const n=R(),a=z(),t=(0,c.KR)(null);let s=null,r=null,i=null,u=null,p=null;const d=(0,c.KR)("heatmap"),v=(0,c.KR)({radius:12,maxZoom:18,max:1,minOpacity:.9,blur:25,gradient:{0:"black",.1:"darkred",.2:"maroon",.3:"red",.4:"orangered",.5:"orange",.6:"gold",.7:"yellow",.8:"lightyellow",.9:"lightyellow",.95:"lightyellow",1:"white"}}),g=(0,c.KR)(!1),m=(0,c.KR)(`leaflet-map-${Math.random().toString(36).substr(2,9)}`),y=()=>{if(!t.value)return!1;const e=t.value.getBoundingClientRect();if(0===e.width||0===e.height)return console.warn("[MapTab] 容器尺寸為零，延遲初始化"),!1;try{s=_().map(t.value,{center:a.mapView.center,zoom:a.mapView.zoom,zoomControl:!1,attributionControl:!1,dragging:!0,touchZoom:!0,doubleClickZoom:!0,scrollWheelZoom:!0,boxZoom:!0,keyboard:!0}),s.on("zoomend",f),s.on("moveend",h);const e=s.createPane("worldPane");e.style.zIndex=200;const n=s.createPane("heatmapPane");n.style.zIndex=400;const l=s.createPane("markerPane");return l.style.zIndex=600,s.getPane("popupPane").style.zIndex=2200,g.value=!0,o("map-ready",s),console.log("[MapTab] 地圖創建成功"),!0}catch(n){return console.error("[MapTab] 地圖創建失敗:",n),!1}},f=()=>{if(s){const e=s.getZoom(),n=s.getCenter();a.setMapView([n.lat,n.lng],e),o("update:zoomLevel",e)}},h=()=>{if(s){const e=s.getCenter();a.setMapView([e.lat,e.lng],s.getZoom()),o("update:currentCoords",{lat:e.lat,lng:e.lng})}},w=()=>{if(!s)return;r&&(s.removeLayer(r),r=null);const e=document.getElementById(m.value);e&&(e.style.backgroundColor="var(--my-color-black)"),console.log("🗺️ 設定黑色海洋背景和世界地圖邊界")},b=async()=>{try{console.log("🌍 開始載入世界地圖...");const e=await fetch("/30DayMapChallenge-15_Fire/data/ne_110m_admin_0_countries.geojson");if(!e.ok)return void console.warn("⚠️ 世界地圖文件不存在，跳過載入");const o=await e.json();u&&s.removeLayer(u),u=_().geoJSON(o,{pane:"worldPane",style:{fillColor:"var(--my-color-gray-900)",weight:1,opacity:.3,color:"var(--my-color-gray-600)",fillOpacity:.9}}),u.addTo(s),console.log("🌍 世界地圖載入完成")}catch(e){console.warn("⚠️ 載入世界地圖失敗，繼續載入儲存的地點:",e)}},L=async()=>{try{console.log("📍 開始載入儲存的地點..."),console.log("📍 當前 dataStore:",n),await n.loadSavedLocations(),console.log("📍 儲存的地點載入完成，數量:",n.savedLocations.length),console.log("📍 前3個地點:",n.savedLocations.slice(0,3)),M()}catch(e){console.error("❌ 載入儲存的地點失敗:",e)}},M=()=>{console.log("🔥 嘗試顯示儲存的地點，模式:",d.value,"地圖實例:",!!s,"地點數量:",n.savedLocations.length),s&&n.savedLocations.length?(i&&s.removeLayer(i),p&&s.removeLayer(p),"point"===d.value?k():C()):console.log("❌ 無法顯示儲存的地點：地圖未準備好或沒有數據")},k=()=>{i=_().layerGroup(),n.savedLocations.forEach((e=>{const[o,n]=e.geometry.coordinates,a=e.properties,t=_().divIcon({className:"location-marker",html:'<div class="location-marker-icon"></div>',iconSize:[12,12],iconAnchor:[6,6]}),l=_().marker([n,o],{icon:t}),s=`\n            <div class="location-popup">\n              <div class="popup-header">\n                <h6 class="popup-title">${a.location?.name||"未知地點"}</h6>\n              </div>\n              <div class="popup-content">\n                <div class="popup-item">\n                  <span class="popup-label">地址</span>\n                  <span class="popup-value">${a.location?.address||"無地址資訊"}</span>\n                </div>\n                <div class="popup-item">\n                  <span class="popup-label">國家</span>\n                  <span class="popup-value">${a.location?.country_code||"Unknown"}</span>\n                </div>\n                <div class="popup-item">\n                  <span class="popup-label">日期</span>\n                  <span class="popup-value">${new Date(a.date).toLocaleDateString()}</span>\n                </div>\n                ${a.google_maps_url?`\n                  <div class="popup-actions">\n                    <a href="${a.google_maps_url}" target="_blank" class="popup-btn">\n                      查看 Google 地圖\n                    </a>\n                  </div>\n                `:""}\n              </div>\n            </div>\n          `;l.bindPopup(s),i.addLayer(l)})),s.addLayer(i),console.log(`📍 已在地圖上顯示 ${n.savedLocations.length} 個點位`)},C=()=>{p&&s.removeLayer(p);const e=n.savedLocations.map(((e,o)=>{const[a,t]=e.geometry.coordinates,l=Math.min(1,(o+1)/n.savedLocations.length);return[t,a,l]}));p=_().heatLayer(e,{...v.value,pane:"heatmapPane"}),s.addLayer(p),console.log(`🔥 已在地圖上顯示 ${n.savedLocations.length} 個地點的熱力圖`)},x=e=>{d.value=e,M()},T=()=>{s&&setTimeout((()=>{s.invalidateSize()}),100)},S=()=>{let e=0;const o=20,n=()=>{e>=o?console.error("[MapTab] 地圖初始化失敗，已達到最大嘗試次數"):(e++,console.log(`[MapTab] 嘗試創建地圖 (${e}/${o})`),y()?(console.log("[MapTab] 地圖創建成功，開始初始化"),w(),setTimeout((async()=>{await b(),await L()}),500)):(console.log("[MapTab] 地圖創建失敗，100ms 後重試"),setTimeout(n,100)))};n()};let O=null,P=null;const I=()=>{t.value&&window.ResizeObserver&&(O=new ResizeObserver((()=>{P&&clearTimeout(P),P=setTimeout((()=>{console.log("🔄 容器大小變化，刷新地圖"),T()}),200)})),O.observe(t.value),console.log("✅ ResizeObserver 已設置"))};return(0,l.sV)((()=>{(0,l.dY)((()=>{S(),I()}))})),(0,l.hi)((()=>{P&&clearTimeout(P),O&&O.disconnect(),s&&(s.remove(),s=null),r=null,i=null,u=null,p=null,g.value=!1})),(0,l.wB)((()=>n.savedLocations),M,{deep:!0}),(0,l.wB)((()=>a.selectedBasemap),(()=>{g.value&&w()})),{mapContainer:t,mapContainerId:m,invalidateSize:T,defineStore:a,dataStore:n,displayMode:d,toggleDisplayMode:x}}};const O=(0,p.A)(S,[["render",x]]);var P=O,I={name:"HomeView",components:{MapTab:P},setup(){const e=R(),o=z(),n=o=>e.setMapInstance(o);return(0,l.sV)((()=>{console.log("🏠 HomeView 初始化完成")})),{setMapInstance:n,defineStore:o,dataStore:e}}};const K=(0,p.A)(I,[["render",f]]);var V=K;const $=[{path:"/",name:"Home",component:V}],E=(0,g.aE)({history:(0,g.LA)("/30DayMapChallenge-15_Fire/"),routes:$});var F=E;n(323);console.log("🎨 樣式文件載入完成");const j=(0,a.Ef)(v),D=(0,t.Ey)();j.use(F),j.use(D),j.mount("#app"),console.log("🚀 空間分析視覺化平台已啟動"),console.log("📦 Pinia 狀態管理已初始化"),console.log("🗺️ Vue Router 路由系統已就緒"),console.log("🎨 Bootstrap 5 UI 框架已載入"),console.log("🗺️ Leaflet 地圖庫已準備就緒"),console.log("🔤 Font Awesome 圖示庫已載入")}},o={};function n(a){var t=o[a];if(void 0!==t)return t.exports;var l=o[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(o,a,t,l){if(!a){var s=1/0;for(u=0;u<e.length;u++){a=e[u][0],t=e[u][1],l=e[u][2];for(var r=!0,i=0;i<a.length;i++)(!1&l||s>=l)&&Object.keys(n.O).every((function(e){return n.O[e](a[i])}))?a.splice(i--,1):(r=!1,l<s&&(s=l));if(r){e.splice(u--,1);var c=t();void 0!==c&&(o=c)}}return o}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,t,l]}}(),function(){n.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(o,{a:o}),o}}(),function(){n.d=function(e,o){for(var a in o)n.o(o,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){var e={524:0};n.O.j=function(o){return 0===e[o]};var o=function(o,a){var t,l,s=a[0],r=a[1],i=a[2],c=0;if(s.some((function(o){return 0!==e[o]}))){for(t in r)n.o(r,t)&&(n.m[t]=r[t]);if(i)var u=i(n)}for(o&&o(a);c<s.length;c++)l=s[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(u)},a=self["webpackChunk_30DayMapChallenge_15_Fire"]=self["webpackChunk_30DayMapChallenge_15_Fire"]||[];a.forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(901)}));a=n.O(a)})();
//# sourceMappingURL=app.feb55a67.js.map